CREATE  SCHEMA MG@

CREATE TABLE MG.PREDMET (
	NAZIV CHAR(50) not null,
	OZNAKA CHAR(5) NOT NULL,
	SEMESTAR INT,
	KATEDRA CHAR,
	PRIMARY KEY (OZNAKA),
	CONSTRAINT K CHECK (KATEDRA IN ('M', 'I'))
)@

DROP TABLE MG.PREDMET@

INSERT INTO MG.PREDMET
	VALUES ('Prevodjenje programskih jezika', 'PPJ', 5, 'I'),
		('Relacione baze podataka', 'RBP', 5, 'I'),
		('Racunarska grafika', 'RG', 5, 'I'),
		('Verovatnoca', 'V', 5, 'M'),
		('Uvod u numericku matematiku', 'UNM', 5, 'M')@
		
SELECT *
FROM MG.PREDMET@

CREATE TABLE MG.ISPITI(
	INDEKS CHAR(10) NOT NULL,
	PREDMET CHAR(5) NOT NULL,
	POENI INT,
	OCENA INT,
	PRIMARY KEY (INDEKS, PREDMET),
	FOREIGN KEY PR (PREDMET) 
		REFERENCES MG.PREDMET ON DELETE NO ACTION
)@

SELECT *
FROM MG.ISPITI@

CREATE OR REPLACE TRIGGER DUPLI_UNOS
	BEFORE INSERT ON MG.ISPITI
	REFERENCING NEW AS N 
		OLD AS O
	FOR EACH ROW
	WHEN (EXISTS (
		select *
		from MG.ISPITI
		where predmet = n.predmet and indeks = n.indeks
	))
		BEGIN
			DELETE FROM MG.ISPITI 
				WHERE INDEKS = N.INDEKS AND PREDMET = N.PREDMET;
		end@
		
		
INSERT INTO MG.ISPITI VALUES
('132/2016', 'RBP', 0, 5),
('99/2018', 'RBP', 71, 8),
('104/2016', 'RBP', 0, 5),
('441/2019', 'RBP', 0, 5),
('225/2018', 'RBP', 65, 7),
('181/2017', 'RBP', 0, 5),
('171/2018', 'RBP', 0, 5),
('240/2018', 'RBP', 71.4, 8),
('300/2018', 'RBP', 0, 5),
('308/2017', 'RBP', 0, 5),
('265/2015', 'RBP', 0, 5),
('28/2018', 'RBP', 54, 6)@